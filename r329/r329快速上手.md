#  MaixSense快速上手

[TOC]

# 烧录固件

## 系统简介

 MaixSense（以下简称R329）提供了以下两种系统镜像

|   名称   |               armbian               |               Tina               |
| :------: | :---------------------------------: | :------------------------------: |
|   简介   | 专门用于`ARM`开发板的轻量级`Debian` |    全志魔改OpenWRT1404的系统     |
|   特点   |        主线化Linux，功能丰富        |        厂商魔改，比较精简        |
| 适用人群 |       极客，嵌入式入门玩家等        | 深度开发，需要自行定制等开发人员 |

> ！！！一定要严格按照步骤操作！！！armbian系统请使用大于 4G 的 TF/SD 卡进行烧录，tina系统请使用大于 1G 的 TF/SD 卡进行烧录

R329为全志的SOC，所以Windows使用PhoenixCard，Linux 上使用Livesuit烧录镜像文件。

- 从下载站获取最新的R329系统镜像 [SDK_MaixII/release](https://dl.sipeed.com/shareURL/MaixII/SDK/release) ，找不到就搜索R329 获取最新的镜像。
- 下载站中有多个同版本不同大小的镜像系统，文件较大的镜像是需要使用dd命令进行系统的烧录。
- 解压 R329镜像压缩包，得到一个 xxxx.img 文件。
- 从网上获取 PhoenixCard(Windows) 烧录工具。

## 镜像文件命名方式

对于R329的镜像文件名字是有对应的规则，以后大家可以根据自己的需求来进行下载

就拿`Armbian_21.08.0-trunk_Maixsense_focal_edge_5.14.0`这镜像文件来说

|  名称   |    含义    |
| :-----: | :--------: |
| Armbian | 使用的系统 |
|         |            |
|         |            |
|         |            |
|         |            |
|         |            |
|         |            |
|         |            |

> 如果是适合使用dd进行烧录，会在最前面多个dd

## Tina系统烧录

镜像下载站连接：

Tina系统的烧录方式和Maix Ⅱ dock通用，可参考[MaixII M2dock 烧录系统 - Sipeed Wiki](https://wiki.sipeed.com/soft/maixpy3/zh/install/maixii_m2dock/flash.html#windows-phoenixcard)，这里不多做介绍

## armbian系统烧录

armbian镜像获取：

> 链接：[https://pan.baidu.com/s/1RM8y...](https://aijishu.com/link?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1RM8yjut_Mnzy6XJF4y-wRg)
> 提取码：kh5n

armbian使用的烧录方式为dd，windows下推荐使用Etcher，linux下推荐使用Terminal。

### windows下系统烧录

资源获取：

​	下载[Etcher](https://www.balena.io/etcher/ "Etcher")

​	下载[SD Card Formatter](https://www.sdcard.org/downloads/formatter/eula_windows/SDCardFormatterv5_WinEN.zip "SDCardFormatter")

首先解压镜像，得到 .img镜像文件，然后使用SD Card Formatter格式化sd卡，打开Etcher，点击`Flash from file`,选中dd镜像包，然后点击`Select target`选中sd卡，最后点击`Flash`烧录。 

![95133](https://raw.githubusercontent.com/USTHzhanglu/picture/main/img/95133.gif)

### linux下系统烧录

首先解压镜像，得到 .img镜像文件，然后格式化sd卡，打开Terminal，输入  `sudo dd if = xxx.img of=/dev/sdx bs=1M status=progress oflag=direct`烧录。注意xxx.img为文件名，  `/dev/sdx`为sd卡实挂载位置。

![2021-08-05-11-44-49](https://raw.githubusercontent.com/USTHzhanglu/picture/main/img/2021-08-05-11-44-49.gif)

同时也可以直接使用Disks进行更便捷的烧录（需要Ubuntu桌面版)：

![2021080511-46-53](https://raw.githubusercontent.com/USTHzhanglu/picture/main/img/2021080511-46-53.gif)

烧录完毕后，即可放入 MaixSense中运行。



# 访问串口

> 请将 USB口插入到 USB UART 口(下面的口）从而获得串口。

## Linux & macOS

Linux 不需要装驱动，系统自带了，使用 `ls /dev/ttyUSB*` 即可看到设备号

## Windows

` MaixSense` 使用了 `CH340` 作为驱动芯片。`Windows` 用户需要安装 `CH340` 的驱动。

Windows 下载 [ch340 ch341 driver](https://api.dl.sipeed.com/shareURL/MAIX/tools/ch340_ch341_driver) 安装即可，然后可以在 `设备管理器` 中看到串口设备

# 配置系统

## Tina系统配置

 MaixSense的Tina系统配置和M2dock基本相同，这里不另作赘述。

## armbian系统配置

R329可以通过OTG外接HID设备直接在屏幕上启动控制台进行操作，也可以通过常用的串口启动控制台。为了方便演示，这里以控制台为例；

通过typec数据线连接MaixSense和电脑，使用Xshell新建会话框，选中新弹出COM，波特率设置115200，连接。

第一次启动大概需要10min时间初始化系统，请耐心等待；

![image-20210805140544186](https://raw.githubusercontent.com/USTHzhanglu/picture/main/img/image-20210805140544186.png)

初始化结束后，需要输入登录密码，密码复杂度要求较高，请多次尝试

```
New to Armbian? Documentation: https://docs.armbian.com Support: https://forum.armbian.com

New root password: **********
Repeat password: **********
```

然后设置默认shell,一般选择bash

```
Choose default system command shell:

1) bash
2) zsh

Shell: BASH
```

然后可以设置一个非root用户日常操作用

```
Creating a new user account. Press <Ctrl-C> to abort

Please provide a username (eg. your forename): ll
Create password: *********
Repeat password: *********
```

![2021080511-46-52](https://raw.githubusercontent.com/USTHzhanglu/picture/main/img/2021080511-46-52.gif)

# 上手使用

## 测试屏幕

硬件正常的话，开机屏幕会自动输出内核信息，也可以使用

`echo "hello sipeed">/dev/tty0`重定向信息到屏幕上。

<img src="https://raw.githubusercontent.com/USTHzhanglu/picture/main/img/image-20210805150728052.png" alt="image-20210805150728052" style="zoom:50%;" />

## 测试摄像头

armbian内置了ffmpeg，可以快速捕捉sensor数据并输出到屏幕上

使用如下命令快速捕捉sensor并输出到屏幕上

```
ffmpeg -i /dev/video0 -vframes 1  -s 240x240 -pix_fmt rgb565le  -vf transpose=2,transpose=2 -f fbdev /dev/fb0
```

![image-20210805165654537](https://raw.githubusercontent.com/USTHzhanglu/picture/main/img/image-20210805165654537.png)

## 测试网络

使用 nmtui 指令可以进入可视化的配网界面，
选择 Activate a connection ， 选择对应的SSID，输入连接密码，确认即可。

![202108051626](https://raw.githubusercontent.com/USTHzhanglu/picture/main/img/202108051626.gif)



设置完毕后使用ifconfig查看本机操作，然后就可以使用ssh等操作了。

![image-20210805162936212](https://raw.githubusercontent.com/USTHzhanglu/picture/main/img/image-20210805162936212.png)

也可以使用apt下载各种应用

```
sudo apt install neofetch
```

![image-20210805165620823](https://raw.githubusercontent.com/USTHzhanglu/picture/main/img/image-20210805165620823.png)

如果遇到终端显示错位，还需要`sudo apt-get install xterm`安装下xterm，然后`resize`即可。

![202108061015](https://raw.githubusercontent.com/USTHzhanglu/picture/main/img/202108061015.gif)

## 测试AIPU

获取1000类物体分类模型

下载站链接[zhouyi_test.tar.xz](),使用任意方式上传到板子中

```
##解压压缩包
tar -xvf zhouyi_test.tar.xz
##授予执行权限
cd zhouyi_test
chmod 777 run.sh
##执行1000类物体分类
./run.sh
##后台执行1000类物体分类
./run.sh < /dev/null > /dev/null 2> 1 
```

